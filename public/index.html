<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="!">
        <meta name="viewport" content="width=device-width, initial-scale=1.0 , maximum-scale=1 , user-scalable=no">

        <!-- Now i have cloudinary link for my favicon image haha haha -->
        <link rel="icon" type="image/x-icon"   href="http://res.cloudinary.com/dlvq8n2ca/image/upload/v1680519379/dkctqfv2bqkrdq3ggen5.png" >

        <title>File upload with Multer</title>

        <link rel="stylesheet" href="./style.css">


    </head>

    <body>

        <main>

            <div class="mainDiv">


                <div class="innerDiv">

                    <div class="punchC">
                        <div>
                            <div></div>
                        </div>
                    </div>

                    <!-- This div used as main content of this page. ==> -->
                    <div class="content">



                        <!-- Loading code from loading io -->
                        <div id="spinner" class="lds-roller">
                            <div></div>
                            <div></div>
                            <div></div>
                            <div></div>
                            <div></div>
                            <div></div>
                            <div></div>
                            <div></div>
                        </div>





                        <div class="heading">
                            <h2>File upload on Cloudinary using Multer</h2>
                        </div>

                        <div class="first">
                            <h3>Upload Images here</h3>
                            <p>Open multiple images that you want to upload.</p>
                            <p>After opening wait for 5 or 10 seconds</p>

                            <form action="" enctype="multipart/form-data">

                                <!-- accept attribute can have like that ===> [accept="image/jpg,image/png,image/jpeg"] or [image/*] both are same , read about more on mdn html file tag  -->

                                <input type="file" id="input_image" name="file" accept="image/*" required multiple>

                                <div id="first_res"></div>

                            </form>
                        </div>

                        <div class="second">
                            <h3>Upload Videos here</h3>
                            <p>Open multiple videos that you want to upload.</p>
                            <p>After opening wait for 10 or 15 seconds</p>

                            <form action="" enctype="multipart/form-data">

                                <input type="file" id="input_video" name="file" accept="video/*" required multiple
                                    size="3000000">

                                <div id="second_res"></div>

                            </form>

                        </div>


                        <div class="third">
                            <h3>This web devloped by Ashish Kuldeep</h3>
                            <p>This website build using NodeJs</p>
                            <p>In nodejs i have used ExpressJs , Multer and Cloudinary.</p>
                            <p>After geting URL, once you successfully upload images or videos, You can use url in your
                                html or in your project</p>
                            <p>Your data is safe only i can see on my Cloudinary account.(Don't share anything personal,
                                that you not want to show anyone.)</p>
                            <p>Thank you for reading and visiting.</p>
                        </div>


                        <div id="all_previous">
                            <h3>This web devloped by Ashish Kuldeep</h3>
                            <p>This website build using NodeJs</p>
                            <button id="show_all_uploads" onclick="showAllUploads()">Show All Uploads</button>

                            <div id="all_upload_res_div"></div>
                        </div>




                    </div>

                    <div class="lastNavi">

                    </div>

                </div>

            </div>

        </main>




        <script>

            // // // Get localstrorage ---------->

            // // For Images
            let imgURL = localStorage.getItem("uploadedImgURL")

            if (imgURL) {
                // alert(imgURL)
                // console.log(imgURL)

                document.getElementById("show_all_uploads").style.visibility = "visible"
                document.getElementById("show_all_uploads").style.display = "inline"

            }

            // // For Videos








            // // // Below function for showing all uploads -------------->

            function showAllUploads() {

                let imgURLData = JSON.parse(imgURL)

                let divForRes = `<div>${imgURLData.length} files got.</div>`

                // // // for all images
                for (let i = 0; i < imgURLData.length; i++) {

                    divForRes += ` <div> <b>${i + 1}</b> <p>${imgURLData[i]} </p> <img src="${imgURLData[i]}" />  </div> `

                }




                // // // for all videos ------>

                document.getElementById("all_upload_res_div").innerHTML = divForRes

            }







            // // // Below is function for post images (starts) ------->
            document.querySelector('#input_image').addEventListener('change', event => {
                handleImageUpload(event)
            })

            async function handleImageUpload(event) {

                try {

                    // console.log(event)


                    const file = event.target.files

                    // console.log( typeof file)
                    // console.log(file)

                    const formData = new FormData()

                    for (let key in file) {
                        // console.log(file[key])
                        formData.append(`file`, file[key])
                    }

                    // formData.append('file', {...file})

                    // console.log(formData)

                    document.querySelector(".first").style.filter = "blur(10px)";
                    document.querySelector("#spinner").style.visibility = "visible"




                    let Option = {
                        method: "POST",
                        body: formData
                    }


                    let req = await fetch("/upload2", Option)
                    let json = await req.json()

                    // console.log(json)


                    if (json.status === false) {
                        alert(json.message)

                        document.querySelector(".first").style.filter = "none";
                        document.querySelector("#spinner").style.visibility = "hidden"



                    }
                    else {

                        document.querySelector(".first").style.filter = "none";
                        document.querySelector("#spinner").style.visibility = "hidden"


                        const arrOfURL = json.data

                        let divForRes = `<div>All ${arrOfURL.length} files uploaded successfully</div>`

                        for (let i = 0; i < arrOfURL.length; i++) {

                            divForRes += ` <div> <b>${i + 1}</b> <p>${arrOfURL[i]} </p> <img src="${arrOfURL[i]}" />  </div> `

                        }

                        document.getElementById("first_res").innerHTML = divForRes


                        localStorage.setItem("uploadedImgURL", JSON.stringify(arrOfURL))

                    }

                } catch (err) {
                    document.querySelector(".first").style.filter = "none";
                    document.querySelector("#spinner").style.visibility = "hidden"
                    console.log(err)
                    return (err.message)
                }



            }


            // // // above function for post images (ends) ------->




            // // // Below function for post videos (starts) --------------->

            document.querySelector('#input_video').addEventListener('change', event => {
                handleVideoUpload(event)
            })


            async function handleVideoUpload(e) {
                alert("Ok working .....")
            }


            // // // Below function for post videos (ends) --------------->



        </script>

    </body>

</html>